# **Documentation ‚Äî Donn√©es n√©cessaires √† la cr√©ation d‚Äôun OR d√©finitif**

---

## **Objectif**

> Identifier, documenter et tracer **toutes les donn√©es n√©cessaires** √† la cr√©ation d‚Äôun **Ordre de R√©exp√©dition (OR) d√©finitif** dans le syst√®me **SIOR**, en pr√©cisant :
>
> * Les champs requis et leurs types
> * Les sources de donn√©es (entit√©, table, DTO, endpoint)
> * Les contraintes fonctionnelles et techniques
> * Les d√©pendances √©ventuelles entre champs

---

## **1. Contexte**

Un **Ordre de R√©exp√©dition (OR)** est un contrat postal permettant de rediriger le courrier d‚Äôun client vers une nouvelle adresse.
L‚Äô**OR d√©finitif** correspond √† la version valid√©e et enregistr√©e du contrat apr√®s saisie compl√®te et v√©rification.

L‚Äôobjectif est de garantir :

* la **coh√©rence des donn√©es saisies** (dates, adresses, statut)
* la **tra√ßabilit√© compl√®te** du dossier (titulaire, agence, audit)
* la **s√©curisation du stockage** via JPA et Liquibase

---

## **2. Structure des donn√©es ‚Äì Vue d‚Äôensemble**

| Source               | Description                                                    |
| -------------------- | -------------------------------------------------------------- |
| **`demande_or`**     | Contient les dates et informations de base li√©es √† la demande  |
| **`contrat`**        | D√©finit le type, le num√©ro et le statut de l‚ÄôOR                |
| **`personne`**       | D√©tient les informations du titulaire et des b√©n√©ficiaires     |
| **`adresse`**        | Stocke les adresses d‚Äôorigine et de destination                |
| **`agence_postale`** | Identifie l‚Äôagence g√©rant la r√©exp√©dition                      |
| **`auditing`**       | G√®re les m√©tadonn√©es de cr√©ation/modification                  |
| **`OrDematDTO`**     | Structure JSON utilis√©e par le front pour la cr√©ation initiale |

---

## **3. Tableau d√©taill√© des champs n√©cessaires √† un OR d√©finitif**

| **Nom du champ**        | **Type Java** | **Type SQL**   | **Source**       | **Description fonctionnelle**                       | **Contraintes**          | **Obligatoire** |
| ----------------------- | ------------- | -------------- | ---------------- | --------------------------------------------------- | ------------------------ | --------------- |
| `id`                    | `Long`        | `BIGSERIAL`    | `demande_or`     | Identifiant unique de la demande d‚ÄôOR               | PK                       | ‚úÖ               |
| `dateDebut`             | `Instant`     | `TIMESTAMP`    | `demande_or`     | D√©but de validit√© de l‚Äôordre                        | NOT NULL                 | ‚úÖ               |
| `dateFin`               | `Instant`     | `TIMESTAMP`    | `demande_or`     | Fin de validit√© de l‚Äôordre                          | `> dateDebut`            | ‚úÖ               |
| `typeOr`                | `String`      | `VARCHAR(20)`  | `contrat`        | Type d‚Äôordre : `TEMPORAIRE` / `DEFINITIF`           | Enum                     | ‚úÖ               |
| `nomTitulaire`          | `String`      | `VARCHAR(255)` | `personne`       | Nom du titulaire                                    | NOT NULL                 | ‚úÖ               |
| `prenomTitulaire`       | `String`      | `VARCHAR(255)` | `personne`       | Pr√©nom du titulaire                                 | NOT NULL                 | ‚úÖ               |
| `civilite`              | `String`      | `VARCHAR(10)`  | `personne`       | Civilit√© (`M`, `Mme`, `Mlle`)                       | Valeur contr√¥l√©e         | ‚ùå               |
| `numContrat`            | `String`      | `VARCHAR(50)`  | `contrat`        | Num√©ro de contrat OR                                | UNIQUE                   | ‚úÖ               |
| `adresseDepart`         | `String`      | `VARCHAR(255)` | `adresse`        | Adresse actuelle du titulaire                       | NOT NULL                 | ‚úÖ               |
| `adresseDestination`    | `String`      | `VARCHAR(255)` | `adresse`        | Nouvelle adresse de r√©exp√©dition                    | NOT NULL                 | ‚úÖ               |
| `codePostalDestination` | `String`      | `VARCHAR(10)`  | `adresse`        | Code postal du lieu de destination                  | V√©rifi√© SIG Postal       | ‚úÖ               |
| `villeDestination`      | `String`      | `VARCHAR(255)` | `adresse`        | Commune de destination                              | ‚Äî                        | ‚úÖ               |
| `agenceGestionnaire`    | `String`      | `VARCHAR(255)` | `agence_postale` | Agence postale g√©rant l‚Äôordre                       | FK ‚Üí `agence_postale.id` | ‚úÖ               |
| `motif`                 | `String`      | `VARCHAR(255)` | `contrat`        | Motif du transfert (facultatif)                     | ‚Äî                        | ‚ùå               |
| `resiliationDate`       | `Instant`     | `TIMESTAMP`    | `contrat`        | Date de r√©siliation si applicable                   | NULLABLE                 | ‚ùå               |
| `isResilie`             | `Boolean`     | `BOOLEAN`      | `contrat`        | Indicateur de r√©siliation                           | Default `false`          | ‚ùå               |
| `statutOr`              | `String`      | `VARCHAR(50)`  | `contrat`        | Statut de l‚Äôordre (`EN_COURS`, `VALIDE`, `RESILIE`) | Enum                     | ‚úÖ               |
| `createdBy`             | `String`      | `VARCHAR(50)`  | `auditing`       | Cr√©ateur du dossier                                 | Auto                     | ‚úÖ               |
| `createdDate`           | `Instant`     | `TIMESTAMP`    | `auditing`       | Date de cr√©ation                                    | Auto                     | ‚úÖ               |
| `lastModifiedBy`        | `String`      | `VARCHAR(50)`  | `auditing`       | Dernier modificateur                                | Auto                     | ‚ùå               |
| `lastModifiedDate`      | `Instant`     | `TIMESTAMP`    | `auditing`       | Date de modification                                | Auto                     | ‚ùå               |

---

## **4. Champs d√©pendants ou conditionnels**

| **Champ**            | **Condition / D√©pendance**                       | **R√®gle**                      |
| -------------------- | ------------------------------------------------ | ------------------------------ |
| `resiliationDate`    | Renseign√© uniquement si `statutOr = 'RESILIE'`   | Contr√¥le logique en service    |
| `motif`              | Facultatif sauf pour certains types de transfert | D√©termin√© par le front         |
| `civilite`           | Non bloquant, mais pr√©sent dans les courriers    | Normalis√© (`M`, `Mme`, `Mlle`) |
| `agenceGestionnaire` | D√©riv√©e automatiquement via l‚Äôadresse postale    | Service SIG / R√©f√©rentiel      |
| `isResilie`          | Calcul√© selon `resiliationDate`                  | Non modifiable c√¥t√© front      |

---

## **5. Sch√©ma logique des sources**

```text
              +----------------------+
              | PERSONNE (Titulaire) |
              +----------+-----------+
                         |
                         | nom, pr√©nom, civilit√©
                         v
+-----------+    +-------+-------+     +----------------+
| DEMANDE_OR| -> | CONTRAT OR   | --> | ADRESSE        |
| (dates)   |    +-------+-------+     +----------------+
|           |            |
|           |            v
|           |     +----------------+
|           |     | AGENCE_POSTALE |
|           |     +----------------+
|           |
|           +--> AUDITING (createdBy, createdDate, etc.)
```

---

## **6. Contraintes et r√®gles d‚Äôint√©grit√©**

| Type                   | D√©tail                                                  |
| ---------------------- | ------------------------------------------------------- |
| **PK**                 | `id` auto-incr√©ment√©e                                   |
| **FK**                 | `agenceGestionnaire` ‚Üí `agence_postale.id`              |
| **FK**                 | `adresseDestination` ‚Üí `adresse.id`                     |
| **FK**                 | `titulaire` ‚Üí `personne.id`                             |
| **Contraintes m√©tier** | `dateFin > dateDebut`, `numContrat` unique              |
| **Statuts possibles**  | `EN_COURS`, `VALIDE`, `RESILIE`                         |
| **Audit**              | Champs `createdBy`, `createdDate` g√©r√©s automatiquement |

---

## **7. Exemple JSON (Frontend ‚Üí Backend)**

```json
{
  "dateDebut": "2025-02-01",
  "dateFin": "2025-03-01",
  "nomTitulaire": "Dupont",
  "prenomTitulaire": "Marie",
  "adresseDepart": "12 Rue de la Poste",
  "adresseDestination": "18 Avenue du Parc",
  "codePostalDestination": "98800",
  "villeDestination": "Noum√©a",
  "agenceGestionnaire": "Agence Principale Noum√©a",
  "typeOr": "DEFINITIF"
}
```

---

## **8. Crit√®res de validation / acceptation**

| Crit√®re                                                     | Attendu | V√©rification  |
| ----------------------------------------------------------- | ------- | ------------- |
| Tous les champs n√©cessaires √† un OR d√©finitif sont recens√©s | Oui     | Section 3     |
| Les sources de donn√©es sont identifi√©es                     | Oui     | Section 2 + 5 |
| Types et contraintes pr√©cis√©s                               | Oui     | Section 3     |
| D√©pendances document√©es                                     | Oui     | Section 4     |
| Sch√©ma de flux complet                                      | Oui     | Section 5     |
| Format Confluence pr√™t √† publication                        | Oui     | Ce document   |

---

## **9. √âtapes suivantes**

| √âtape | Action                                                                    |
| ----- | ------------------------------------------------------------------------- |
| 1Ô∏è‚É£   | Cr√©er l‚Äôentit√© `OrdreReexpedition` compl√®te avec toutes les relations JPA |
| 2Ô∏è‚É£   | Mettre √† jour le `OrDefinitifDTO` et le `Mapper` associ√©                  |
| 3Ô∏è‚É£   | Documenter le nouvel endpoint `/api/or-definitif`                         |
| 4Ô∏è‚É£   | Pr√©parer les tests d‚Äôint√©gration et de validation m√©tier                  |
| 5Ô∏è‚É£   | Publier la documentation dans Confluence et notifier l‚Äô√©quipe m√©tier      |

---

## **R√©f√©rences techniques**

* üîó [Spring Data JPA Documentation](https://spring.io/projects/spring-data-jpa)
* üîó [Liquibase ‚Äì Database Change Management](https://www.liquibase.org/)
* üîó [MapStruct Mapper Framework](https://mapstruct.org/)
* üîó [JHipster Architecture](https://www.jhipster.tech/architecture/)
* üîó [SIOR ‚Äì Documentation interne](https://confluence.opt.nc/display/SIOR)

---

Souhaites-tu que je t‚Äôajoute, juste apr√®s celle-ci, la **fiche compl√©mentaire ‚ÄúVue de flux des donn√©es OR (diagramme UML + mapping DTO ‚Üî Entit√© ‚Üî Table)‚Äù**, pour compl√©ter la tra√ßabilit√© visuelle sur Confluence ?
Ce serait la *phase 2* logique de cette nouvelle t√¢che.
